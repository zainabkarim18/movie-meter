<%- include('../partials/head.ejs') %>
<style>

</style>
<body>
  <div class="container mt-5">

    <h1 class="text-center mb-4"><%= oneMovie.title %></h1>
<% if (user&& user.role=='admin') { %>
    <div class="text-end mb-4">
      <form action="/movies/delete/<%= oneMovie._id %>?_method=DELETE" method="POST" class="d-inline">
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
      <a href="/movies/edit/<%= oneMovie._id %>" class="btn btn-warning ms-2">Edit</a>
    </div>
  <% } %>

    <div class="row mb-4">
      <div class="col-md-4 mb-4 mb-md-0">
        <img src="<%= oneMovie.image %>" alt="<%= oneMovie.title %>" class="img-fluid rounded shadow-sm">
      </div>
      <div class="col-md-8">
        <div class="mb-3">
          <h4>Title:</h4>
          <p><%= oneMovie.title %></p>
        </div>
        <div class="mb-3">
          <h4>Genre:</h4>
          <p><%= oneMovie.genre %></p>
        </div>
        <div class="mb-3">
          <h4>Description:</h4>
          <p><%= oneMovie.description %></p>
        </div>
        <div class="mb-3">
          <h4>Duration:</h4>
          <p><%= oneMovie.duration %></p>
        </div>
        <div class="mb-3">
          <h4>Language:</h4>
          <p><%= oneMovie.language %></p>
        </div>
      </div>
    </div>

    
    <div class="my-4 ratings-container">
      <h4 class="text-end">Ratings:
        <% for (let i = 0; i < Math.floor(avgRate); i++) { %>
          <span style="font-size: 1.5rem; color: gold;">&#9733;</span>
        <% } %>
        <% if (avgRate % 1 !== 0) { %>
          <span style="font-size: 1.5rem; color: gold;">&#9733;</span>
        <% } %>
        <% for (let i = Math.ceil(avgRate); i < 5; i++) { %>
          <span style="font-size: 1.5rem; color: gray;">&#9734;</span>
        <% } %>
      </h4>
      <ul class="list-unstyled text-start">
        <% allRates.forEach(rate => { %>
          <li>
            <div class="comment-box">
              <!-- <h5 class="fw-bold"><%= //user.username %></h5>
              <p>Rate: <%= rate.rate %></p> -->
              <p>Comment: <%= rate.comment %></p>
            </div>
          </li>
        <% }) %>
      </ul>
    </div>

 <% if (user) { %>
    <div class="text-end mb-4">
      <form action="/movies/favorites/add/<%= oneMovie._id %>" method="POST" class="d-inline ms-2">
        <button type="submit" class="btn btn-success">Add to Favorites</button>
      </form>
      <a href="/movies/rates/add/<%= oneMovie._id %>" class="btn btn-primary ms-2">Add a Review</a>
    </div>
  <% } %>
  </div>
<%- include('../partials/footer.ejs') %>